<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pub/Sub System</title>
  <style>
    .container {
        display: flex;
        font-family: Arial, sans-serif;
    }
    .left-panel {
        width: 30%;
        padding: 20px;
        background-color: #f0f0f0;
    }
    .right-panel {
        width: 70%;
        padding: 20px;
    }
    h2 {
        margin-top: 0;
    }
    div {
        margin-bottom: 20px;
    }
    label {
        display: block;
        margin: 5px 0;
    }
    input[type="text"] {
        width: 80%;
        padding: 5px;
    }
    button {
        padding: 5px 10px;
        margin-top: 5px;
    }
    iframe {
        border: 1px solid #ccc;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="left-panel">
    <h2>Pub/Sub System</h2>
    <div>
      <h3>Config Upload</h3>
      <input type="file" id="configFile">
      <button onclick="uploadConfig()">Deploy</button>
    </div>
    <div>
      <h3>Publish Message</h3>
      <form action="/publish" method="GET">
        <label for="topic">Topic name:</label>
        <input type="text" id="topic" name="topic" placeholder="e.g., B">
        <label for="message">Message:</label>
        <input type="text" id="message" name="message" placeholder="e.g., 5">
        <button type="submit">Send</button>
      </form>
    </div>
  </div>
  <div class="right-panel">
    <h2>Graph Visualization</h2>
    <iframe src="/app/graph.html" width="100%" height="500px"></iframe>
  </div>
</div>
<script>
  function uploadConfig() {
      const fileInput = document.getElementById('configFile');
      const file = fileInput.files[0];
      if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
              const configContent = e.target.result;
              fetch('/upload', {
                  method: 'POST',
                  body: configContent,
                  headers: {
                      'Content-Type': 'text/plain'
                  }
              }).then(response => {
                  if (response.redirected) {
                      window.location.href = response.url;
                  }
              }).catch(error => {
                  console.error('Upload failed:', error);
              });
          };
          reader.readAsText(file);
      } else {
          alert('Please select a configuration file.');
      }
  }
</script>
</body>
</html>